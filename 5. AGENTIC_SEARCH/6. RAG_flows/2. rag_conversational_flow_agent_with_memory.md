# RAG Conversational Flow Agent with Memory

## Overview

This workflow demonstrates a complete Retrieval-Augmented Generation (RAG) system with conversational memory capabilities. The agent combines vector similarity search with OpenAI's language model to provide contextual, data-driven responses while maintaining conversation history.

## Workflow Diagram

```mermaid
flowchart TD
    A[Start] --> B[Setup Cluster Settings]
    B --> C[Register Embedding Model]
    C --> D{Embedding Model Ready?}
    D -->|No| E[Wait 5 seconds]
    E --> D
    D -->|Yes| F[Create Ingest Pipeline]
    F --> G[Create Vector Index]
    G --> H[Load Sample Population Data]
    H --> I[Setup Model Group]
    I --> J[Create OpenAI Connector]
    J --> K[Register OpenAI Model]
    K --> L{OpenAI Model Ready?}
    L -->|No| M[Wait 5 seconds]
    M --> L
    L -->|Yes| N[Test OpenAI Model]
    N --> O[Create RAG Agent]
    O --> P[First Question: Seattle Population]
    P --> Q[Vector Search for Context]
    Q --> R[Generate Response with LLM]
    R --> S[Store in Memory]
    S --> T[Continue Conversation]
    T --> U[Use Previous Context]
    U --> V[Generate Contextual Response]
    V --> W[Explore Memory & Traces]
    W --> X[End]

    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
    classDef setup fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef data fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef ai fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef conversation fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000
    classDef memory fill:#fff8e1,stroke:#f57f17,stroke-width:2px,color:#000

    class A,X startEnd
    class B,C,F,G,I,J,K,O setup
    class D,L decision
    class H,Q data
    class N,R,V ai
    class P,T,U conversation
    class S,W memory
    class E,M setup
```

## Key Components

### 1. Infrastructure Setup
- **Cluster Configuration**: Enables ML operations and memory features in OpenSearch
- **Embedding Model**: Deploys sentence-transformers model for text vectorization
- **Vector Index**: Creates k-NN enabled index with embedding pipeline for automatic vectorization
- **Sample Data**: Loads population statistics for various US metropolitan areas

### 2. AI Integration
- **OpenAI Connector**: Establishes secure connection to OpenAI's GPT-3.5-turbo model
- **Model Registration**: Registers and deploys the language model for text generation
- **Connector Testing**: Validates the AI integration with sample predictions

### 3. RAG Agent Architecture
- **Vector Search Tool**: Retrieves relevant context using semantic similarity
- **Language Model Tool**: Generates responses based on retrieved context and conversation history
- **Memory Management**: Maintains conversation state across multiple interactions

### 4. Conversational Flow
- **Context Retrieval**: Uses vector similarity to find relevant documents
- **Response Generation**: Combines retrieved context with user questions
- **Memory Persistence**: Stores conversation history for future reference
- **Contextual Awareness**: References previous conversation elements in follow-up responses

## Use Cases

- **Intelligent Data Analysis**: Ask natural language questions about complex datasets
- **Conversational Search**: Maintain context across multiple related queries
- **Knowledge Base Interaction**: Interact with corporate knowledge using natural language
- **Customer Support**: Provide contextual assistance based on documentation

## Technical Features

- **Semantic Search**: Vector embeddings enable meaning-based document retrieval
- **Conversation Memory**: Maintains context across multiple question-answer cycles
- **Hybrid Intelligence**: Combines retrieval accuracy with generative capabilities
- **Trace Analysis**: Full observability into the reasoning and retrieval process

## Memory Management

The system provides comprehensive conversation tracking:
- **Memory Details**: Access to complete conversation state
- **Message History**: Chronological record of all interactions
- **Execution Traces**: Step-by-step breakdown of how responses were generated
- **Context Propagation**: Seamless context flow between related questions